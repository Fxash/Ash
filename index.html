
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fx Ash Trading Analyzer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Fx Ash Trading Analyzer</h1>
  </header>

  <main>
    <section id="controls">
      <label for="synthetic-select">Select Market:</label>
      <select id="synthetic-select">
        <option value="R_10">R_10</option>
        <option value="R_10_1s">R_10_1s</option>
        <option value="R_25">R_25</option>
        <option value="R_25_1s">R_25_1s</option>
        <option value="R_50">R_50</option>
        <option value="R_50_1s">R_50_1s</option>
        <option value="R_75">R_75</option>
        <option value="R_75_1s">R_75_1s</option>
        <option value="R_100">R_100</option>
        <option value="R_100_1s">R_100_1s</option>
      </select>

      <label for="tick-sequence">Tick Sequence:</label>
      <select id="tick-sequence">
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
      </select>

      <button id="start-btn">Start Analysis</button>
      <button id="stop-btn">Stop Analysis</button>
    </section>

    <section id="market-data">
      <h2>Market Data</h2>
      <p id="last-digit">Last Digit: -- (Price: --)</p>
      <p id="entry">Entry: --</p>
    </section>

    <section id="circles-container">
      <div class="circle" data-digit="0">0<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="1">1<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="2">2<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="3">3<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="4">4<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="5">5<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="6">6<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="7">7<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="8">8<br><span class="percent">0%</span></div>
      <div class="circle" data-digit="9">9<br><span class="percent">0%</span></div>
    </section>

    <section id="probabilities">
      <div id="over-box">Over: 0%</div>
      <div id="under-box">Under: 0%</div>
    </section>

    <section id="history">
      <h2>History</h2>
      <p id="history-data">--</p>
    </section>

    <footer>
      <p>Fx Ash Strategy</p>
    </footer>
  </main>

  <script src="script.js"></script>
</body>
</html>
body {
  background-color: #0b0b0b;
  color: #fff;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}

header {
  background-color: #111;
  text-align: center;
  padding: 1rem;
  font-size: 1.8rem;
  color: #00ffea;
}

main {
  padding: 1rem;
}

#controls {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 1rem;
}

#market-data {
  margin-bottom: 1rem;
}

#circles-container {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-bottom: 1rem;
}

.circle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background-color: #222;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-size: 1.2rem;
  text-align: center;
  border: 2px solid #444;
  position: relative;
}

.circle.selected {
  background-color: #007bff;
}

.circle .percent {
  font-size: 0.7rem;
  color: #0f0;
}

#probabilities {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
}

#over-box {
  background-color: #0a0;
  padding: 0.5rem 1rem;
  border-radius: 5px;
}

#under-box {
  background-color: #a00;
  padding: 0.5rem 1rem;
  border-radius: 5px;
}

footer {
  text-align: center;
  margin-top: 2rem;
  font-size: 0.8rem;
  color: #555;
}// Fx Ash Trading Analyzer - WebSocket Auto Connect
const APP_ID = '112324';
const API_TOKEN = 'Ar1I3t2f191vnsZ';

let socket;
let analysisRunning = false;
let tickHistory = [];
let lastDigit = null;

const startBtn = document.getElementById('start-btn');
const stopBtn = document.getElementById('stop-btn');
const syntheticSelect = document.getElementById('synthetic-select');
const tickSequenceSelect = document.getElementById('tick-sequence');

const lastDigitDisplay = document.getElementById('last-digit');
const entryDisplay = document.getElementById('entry');
const historyDisplay = document.getElementById('history-data');
const overBox = document.getElementById('over-box');
const underBox = document.getElementById('under-box');

const circles = Array.from(document.querySelectorAll('.circle'));

// Connect WebSocket
function connectWebSocket() {
  socket = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${APP_ID}`);

  socket.onopen = () => {
    console.log('Connected to Deriv');
    authorize();
  };

  socket.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.error) {
      console.error('Deriv Error:', data.error.message);
      return;
    }

    if (data.msg_type === 'authorize') {
      console.log('Authorized successfully');
      subscribeTicks();
    }

    if (data.msg_type === 'tick') {
      handleTick(data.tick);
    }
  };

  socket.onerror = (err) => console.error('WebSocket error', err);
  socket.onclose = () => console.log('Connection closed');
}

// Authorize
function authorize() {
  socket.send(JSON.stringify({
    authorize: API_TOKEN
  }));
}

// Subscribe to ticks
function subscribeTicks() {
  const market = syntheticSelect.value;
  socket.send(JSON.stringify({
    ticks: market,
    subscribe: 1
  }));
}

// Handle incoming tick
function handleTick(tick) {
  lastDigit = parseInt(tick.quote.toString().slice(-1));
  lastDigitDisplay.textContent = `Last Digit: ${lastDigit} (Price: ${tick.quote})`;

  tickHistory.push(lastDigit);
  if (tickHistory.length > 10) tickHistory.shift();

  historyDisplay.textContent = tickHistory.join(', ');

  updateCircles();
  updateProbabilities();
  determineEntry();
}

// Update circle highlights & percentages
function updateCircles() {
  const counts = Array(10).fill(0);
  tickHistory.forEach(d => counts[d]++);
  
  circles.forEach(circle => {
    const digit = parseInt(circle.dataset.digit);
    const percent = ((counts[digit] / tickHistory.length) * 100).toFixed(1);
    circle.querySelector('.percent').textContent = `${percent}%`;

    circle.classList.remove('selected');
    if (digit === lastDigit) circle.classList.add('selected');
  });
}

// Update over/under probabilities
function updateProbabilities() {
  const overCount = tickHistory.filter(d => d > 3).length;
  const underCount = tickHistory.filter(d => d <= 3).length;
  const total = tickHistory.length || 1;

  overBox.textContent = `Over: ${((overCount / total) * 100).toFixed(1)}%`;
  underBox.textContent = `Under: ${((underCount / total) * 100).toFixed(1)}%`;
}

// Determine entry based on tick sequence
function determineEntry() {
  const sequenceLength = parseInt(tickSequenceSelect.value);

  // Basic example: pick the first under/over digit meeting your rules
  let candidate = null;

  // Count occurrences
  const counts = Array(10).fill(0);
  tickHistory.forEach(d => counts[d]++);

  // Example: if over 3 rule
  const overDigits = [];
  for (let i = 4; i <= 9; i++) if (counts[i] >= 1) overDigits.push(i);

  // Pick entry based on sequence length and over/under rules
  if (overDigits.length > 0) candidate = overDigits[0];
  else candidate = tickHistory[tickHistory.length - 1] || 0;

  entryDisplay.textContent = `Entry: ${candidate}`;
}

// Start/Stop Analysis
startBtn.onclick = () => {
  if (!analysisRunning) {
    analysisRunning = true;
    connectWebSocket();
  }
};

stopBtn.onclick = () => {
  analysisRunning = false;
  if (socket) socket.close();
};

// Circle click to manually select
circles.forEach(circle => {
  circle.addEventListener('click', () => {
    const digit = circle.dataset.digit;
    entryDisplay.textContent = `Entry: ${digit}`;
  });
});

